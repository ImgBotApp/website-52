include ../template/_mixins

.row.row--fullheight(ng-controller="ReleaseListCtrl as vm")

	//- main column
	.col-sm-9.col--main
		h1.h--primary Releases

		//- view type toggles
		ul.nav-icons
			li.a(ng-class="{ active: vm.viewtype == 'compact' }")
				+icon('th-compact')(ng-click="vm.switchview('compact')")
			li.a(ng-class="{ active: vm.viewtype == 'extended' }")
				+icon('th-extended')(ng-click="vm.switchview('extended')")
		hr

		//- number of games counter
		.pull-left(ng-show="vm.releases.length > 0")
			span.small {{ vm.pagination.count }} RELEASE{{ vm.pagination.count == 1 ? '' : 'S' }}

		//- pagination
		.pull-right(ng-show="vm.releases.length > 0")
			+paginator('vm.pagination', 'vm.paginate')

		.clearfix.padder-bottom(ng-show="vm.releases.length > 0")

		//- no releases
		p(ng-show="!vm.releases.length && !vm.pageLoading") No releases found.

		//- loading
		p(ng-show="vm.pageLoading && !vm.error")
			+icon('circle-o-notch').small.svg-spin.space-right.shift-up
			| Loading...

		//- error
		p(ng-show="error") Error: {{ vm.error }}

		//- content
		.row.ng-cloak
			.fade2-animation(ng-switch="vm.viewtype")

				div(ng-switch-when="compact")
					.col-md-4.col-sm-6.col-xs-12.fade-animation(ng-repeat="release in vm.releases", ui-sref="releaseDetails({ id: release.game.id, releaseId: release.id })")
						.panel.panel--animated.ng-cloak
							.img.img--rounded-top(img-bg="release.thumb.image.url", ng-class="flavorFilter && flavorFilter.orientation === 'ws' ? 'img--ar-ws' : 'img--ar-fs'")
							.text-center.padder-horizontal
								h1.h--small {{ release.game.title }}
								label.label--subtitle {{ release.name }}
								.center-block.padder-bottom-2x
									img.img-avatar.img-avatar--xsm.space-v(
										ng-repeat="author in release.authors",
										gravatar-src="author.user.gravatar_id",
										gravatar-default="retro",
										fallback-icon="user",
										title="{{ author.user.name }}: {{ author.roles.join(', ') }}"
									)

				div(ng-switch-when="extended")
					.col-lg-6.col-md-12(ng-repeat="release in vm.releases", ui-sref="releaseDetails({ id: release.game.id, releaseId: release.id })")
						.panel.panel--animated.panel--animated--less.ng-cloak
							.clearfix
							.col--list-mini-left
								.img.img--ar-square.img--rounded-left(img-bg="release.thumb.image.url")
							.col--list-mini-right
								.a.pull-right.space-right(
								uib-tooltip="{{ release.starred ? 'Unstar' : 'Star' }} this release",
									tooltip-placement="right",
									tooltip-append-to-body="true",
									ng-show="vm.AuthService.hasPermission('releases/star')",
									ng-class="{ 'a--primary': release.starred }"
								)
									+icon('star')(ng-click="vm.ReleaseService.toggleReleaseStar(release, $event)").shift-up-2x
								h1.h--small.h--no-margin {{ release.game.title }}
								label.label--block {{ release.name }}
								span.small.pull-right.space-right {{ release.released_at | timeAgo }}
								div.small.oneliner by {{ release.authors[0].user.name }}
							.clearfix


	.col-sm-3.col--menu
		h1 Filter
		hr

		// search box
		.input-group.padder-bottom
			span.input-group-addon.input-group-addon--search
				+icon('search').smaller
			input.form-control.input--search(ng-model="vm.q", type="text", placeholder="Search")

		// starred only
		span(ng-show="vm.AuthService.isAuthenticated")
			input#starredOnly.checkbox--toggle(type='checkbox', ng-model="vm.starredOnly")
			label(for="starredOnly")
			label.a.a--light.padder-bottom(for="starredOnly") Starred releases only
			.clearfix

		// filters
		.panel-group--transparent(uib-accordion, close-others="false")

			// compat filter
			.panel--inner(uib-accordion-group, is-open="vm.filterBuildOpen")
				div(uib-accordion-heading) by Compatibility
				.row
					p.space-left-2x Official:
					.col-xs-6.text-center.a(ng-repeat="build in vm.builds | filter:{is_range:false,type:'release'}" filter-build="{{ build.id }}") {{ build.label }}
				.row
					p.space-left-2x.padder-top Experimental:
					.col-xs-6.text-center.a(ng-repeat="build in vm.builds | filter:{is_range:false,type:'experimental'}" filter-build="{{ build.id }}") {{ build.label }}

			// flavor filters
			.panel--inner(uib-accordion-group, ng-repeat="flavor in vm.flavors", is-open="vm.filterFlavorOpen[flavor.name]")
				div(uib-accordion-heading) by {{ flavor.header }}
				ul.list--checkboxes.list--condensed
					li
						.radio--lg
							label
								input(type="radio", name="{{ flavor.name }}", value="", ng-model="flavorFilter[flavor.name]", ng-change="onFlavorChange()")
								span No Filter

					li(ng-repeat="flavorVal in flavor.values")
						.radio--lg.radio--lg-twoliner
							label
								input(type="radio", name="{{ flavor.name }}", value="{{ flavorVal.value }}", ng-model="flavorFilter[flavor.name]", ng-change="onFlavorChange()")
								span {{ flavorVal.name }}
								span: i {{ flavorVal.other }}

			// tag filter
			.panel--inner(uib-accordion-group, is-open="vm.filterTagOpen")
				div(uib-accordion-heading) by Tag
				.row
					.col-xs-6.text-center.a(ng-repeat="tag in vm.tags" filter-tag="{{ tag.id }}", title="{{ tag.description }}") {{ tag.name }}

			// validation filter
			.panel--inner(uib-accordion-group, is-open="vm.filterValidationOpen")
				div(uib-accordion-heading) by Validation
				.row
					.col-xs-6.col-lg-3.text-center.a(ng-class="{active: $parent.$parent.validation === 'verified'}", ng-click="vm.toggleValidation('verified')")
						+icon('medal-verified').svg-3x.padder-bottom
						| Verified
					.col-xs-6.col-lg-3.text-center.a(ng-class="{active: $parent.$parent.validation === 'playable'}", ng-click="vm.toggleValidation('playable')")
						+icon('medal-playable').svg-3x.padder-bottom
						| Playable
					.clearfix.show.hidden-lg.padder-bottom
					.col-xs-6.col-lg-3.text-center.a(ng-class="{active: $parent.$parent.validation === 'broken'}", ng-click="vm.toggleValidation('broken')")
						+icon('medal-broken').svg-3x.padder-bottom
						| Broken
					.col-xs-6.col-lg-3.text-center.a(ng-class="{active: $parent.$parent.validation === 'none'}", ng-click="vm.toggleValidation('none')")
						+icon('medal-unknown').svg-3x.padder-bottom
						| None

				.clearfix
				//-a.a.pull-right(ng-click="validationInfo()")
					+icon('info').small.shift-up-less.space-right-less
					i What's this?

		h1 Sort
		hr
		ul.list--sort-options
			li.a(sort="title", d="asc") Name
			li.a(sort="released_at", d="desc") Date
			li.a(sort="rating", d="desc") Rating
			li.a(sort="popularity", d="desc") Popularity
